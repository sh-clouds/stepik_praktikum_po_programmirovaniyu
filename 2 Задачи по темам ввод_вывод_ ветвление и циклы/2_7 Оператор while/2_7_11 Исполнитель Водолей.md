Исполнитель Водолей

У исполнителя “Водолей” есть два сосуда, первый объемом A литров, второй объемом B литров, а также кран с водой. Водолей может выполнять следующие операции:

Наполнить сосуд A (обозначается >A).
Наполнить сосуд B (обозначается >B).
Вылить воду из сосуда A (обозначается A>).
Вылить воду из сосуда B (обозначается B>).
Перелить воду из сосуда A в сосуд B (обозначается как A>B).
Перелить воду из сосуда B в сосуд A (обозначается как B>A).
Команда переливания из одного сосуда в другой приводят к тому, что либо первый сосуд полностью опустошается, либо второй сосуд полностью наполняется.

Входные данные
Программа получает на вход три натуральных числа A, B, N, не превосходящих 104.

Выходные данные
Необходимо вывести алгоритм действий Водолея, который позволяет получить в точности N литров в одном из сосудов, если же такого алгоритма не существует, то программа должна вывести текст Impossible.

Количество операций в алгоритме не должно превышать 105. Гарантируется, что если задача имеет решение, то есть решение, которое содержит не более, чем 105 операций.

Sample Input:
3
5
1

Sample Output:
>A
A>B
>A
A>B
Напишите программу. Тестируется через stdin → stdout
Верно решили 147 учащихся
Из всех попыток 12% верных


# ruby
a_full, b_full, n = gets.to_i, gets.to_i, gets.to_i 

def isImpossible(a_full, b_full, n)
    f = false
    a, b = 0, 0 
    cnt = 0
    cnt_max = 100000    
    
    if a_full <= b_full   
        while (a != n) and (b != n)
            #наполнить ведро A
            a = a_full
            #print (">A")
            cnt +=1

            if cnt > cnt_max
                a = n
                #print ("Impossible")
                f = true
                break
            end

            if (a == n) or (b == n)
                break
            end    

            while true
                #перелить ведро в банку B
                #print ("A>B")
                cnt +=1   

                if cnt > cnt_max
                    a = n
                    #print ("Impossible")
                    f = true
                    break
                end    

                if b + a >= b_full
                    a -= b_full - b
                    b = b_full            
                else    
                    b = b + a
                    a = 0
                end
                
                if (a == n) or (b == n)
                    break
                end
                
                #проверить, что ведро опустошено A
                if a==0
                    break
                else
                    #проверить, что банка наполнена B      
                    if b == b_full
                        #опустошить банку
                        #print ("B>")
                        cnt +=1                
                        b = 0
                    end
                end    

                if cnt >= cnt_max
                    a = n
                    #print ("Impossible")
                    f = true
                    break
                end
            end # end while true    

            if cnt >= cnt_max
                a = n
                #print ("Impossible")
                f = true
                break
            end
        end # end while a,b    

                
    elsif (a_full==n) 
        f = false
        #print (">A")
        
    else            
        while (a != n) and (b != n)
            #наполнить банку B
            b = b_full
            #print (">B")
            cnt +=1

            if cnt > cnt_max
                a = n
                #print ("Impossible")
                f = true
                break
            end    

            if (a == n) or (b == n)
                break
            end    

            while true
                #перелить банку B в ведро A
                #print ("B>A")
                cnt +=1    

                if cnt > cnt_max
                    a = n
                    #print ("Impossible")
                    f = true
                    break
                end    

                if b + a >= a_full
                    b -= a_full - a
                    a = a_full            
                else    
                    a = a + b
                    b = 0
                end
                
                if (a == n) or (b == n)
                    break
                end

                #проверить, что банка опустошена B
                if b==0
                    break
                else
                    #проверить, что ведро наполнено A      
                    if a == a_full
                        #опустошить ведро
                        #print ("A>")
                        cnt +=1              
                        a = 0
                    end
                end    

                if cnt >= cnt_max
                    a = n
                    #print ("Impossible")
                    f = true
                    break
                end
            end  # end while true              
                
            if cnt >= cnt_max
                a = n
                #print ("Impossible")
                f = true
                break 
            end
        end # end while a, b
    end    
    
    return f
end    

#///////////////////////////////////////end def
fi = isImpossible(a_full, b_full, n)
if fi == true
    print "Impossible"
end    

a, b = 0, 0     
if a_full <= b_full   
    while (a != n) and (b != n) and (fi==false)
        #наполнить ведро A
        a = a_full
        print ">A\n"
        
        if (a == n) or (b == n)
            break
        end

        while true
            #перелить ведро в банку B
            print "A>B\n"           
            
            if b + a >= b_full
                a -= b_full - b
                b = b_full            
            else    
                b = b + a
                a = 0
            end
            
            if (a == n) or (b == n)
                break
            end    

            #проверить, что ведро опустошено A
            if a==0
                break
            else
                #проверить, что банка наполнена B      
                if b == b_full
                    #опустошить банку
                    print ("B>\n")               
                    b = 0
                end
            end
        end # end while true
    end # end while a, b, fi
               
elsif (a_full==n) 
    print ">A\n"
else            
    while (a != n) and (b != n) and (fi==false)
        #наполнить банку B
        b = b_full
        print ">B\n"
            
        if (a == n) or (b == n)
            break
        end

        while true
            #перелить банку B в ведро A
            print "B>A\n"
            
            if b + a >= a_full
                b -= a_full - a
                a = a_full            
            else    
                a = a + b
                b = 0
            end
            
            if (a == n) or (b == n)
                break
            end    

            #проверить, что банка опустошена B
            if b==0
                break                
            else
                #проверить, что ведро наполнено A      
                if a == a_full
                    #опустошить ведро
                    print "A>\n"             
                    a = 0
                end
            end
        end # end true
    end # end while a, b, fi
end



# python
a_full, b_full, n = int(input()), int(input()), int(input())
#a_full, b_full, n = 3, 5, 1
#a_full, b_full, n = 60, 1, 6
#a_full, b_full, n = 4, 20, 7
#a_full, b_full, n = 600, 5, 60
#a_full, b_full, n = 2, 3, 2
#a_full, b_full, n = 55, 15, 55

def isImpossible():
    f = False
    a, b = 0, 0 
    cnt = 0
    cnt_max = 100000    
    
    if a_full <= b_full:   
        while (a != n) and (b != n): 
            #наполнить ведро A
            a = a_full
            #print (">A")
            cnt +=1

            if cnt > cnt_max:
                a = n
                #print ("Impossible")
                f = True
                break

            if (a == n) or (b == n):
                break

            while True:
                #перелить ведро в банку B
                #print ("A>B")
                cnt +=1   

                if cnt > cnt_max:
                    a = n
                    #print ("Impossible")
                    f = True
                    break            

                if b + a >= b_full:
                    a -= b_full - b
                    b = b_full            
                else:    
                    b = b + a
                    a = 0
                if (a == n) or (b == n):
                    break

                #проверить, что ведро опустошено A
                if a==0:
                    break
                else:
                    #проверить, что банка наполнена B      
                    if b == b_full:
                        #опустошить банку
                        #print ("B>")
                        cnt +=1                
                        b = 0

                if cnt >= cnt_max:
                    a = n
                    #print ("Impossible")
                    f = True
                    break

            if cnt >= cnt_max:
                a = n
                #print ("Impossible")
                f = True
                break

                
    elif (a_full==n): 
        f = False
        #print (">A")
        
    else:            
        while (a != n) and (b != n):
            #наполнить банку B
            b = b_full
            #print (">B")
            cnt +=1

            if cnt > cnt_max:
                a = n
                #print ("Impossible")
                f = True
                break

            if (a == n) or (b == n):
                break

            while True:
                #перелить банку B в ведро A
                #print ("B>A")
                cnt +=1    

                if cnt > cnt_max:
                    a = n
                    #print ("Impossible")
                    f = True
                    break

                if b + a >= a_full:
                    b -= a_full - a
                    a = a_full            
                else:    
                    a = a + b
                    b = 0
                if (a == n) or (b == n):
                    break

                #проверить, что банка опустошена B
                if b==0:
                    break
                else:
                    #проверить, что ведро наполнено A      
                    if a == a_full:
                        #опустошить ведро
                        #print ("A>")
                        cnt +=1              
                        a = 0

                if cnt >= cnt_max:
                    a = n
                    #print ("Impossible")
                    f = True
                    break
            if cnt >= cnt_max:
                a = n
                #print ("Impossible")
                f = True
                break    
    
    return f

#///////////////////////////////////////end def
fi = isImpossible()
if fi == True:
    print ("Impossible")

a, b = 0, 0     
if a_full <= b_full:   
    while (a != n) and (b != n) and (fi==False): 
        #наполнить ведро A
        a = a_full
        print (">A")
        
        if (a == n) or (b == n):
            break

        while True:
            #перелить ведро в банку B
            print ("A>B")            
            
            if b + a >= b_full:
                a -= b_full - b
                b = b_full            
            else:    
                b = b + a
                a = 0
            if (a == n) or (b == n):
                break

            #проверить, что ведро опустошено A
            if a==0:
                break
            else:
                #проверить, что банка наполнена B      
                if b == b_full:
                    #опустошить банку
                    print ("B>")               
                    b = 0

elif (a_full==n): 
    print (">A")                    
else:            
    while (a != n) and (b != n) and (fi==False):
        #наполнить банку B
        b = b_full
        print (">B")
            
        if (a == n) or (b == n):
            break

        while True:
            #перелить банку B в ведро A
            print ("B>A")
            
            if b + a >= a_full:
                b -= a_full - a
                a = a_full            
            else:    
                a = a + b
                b = 0
            if (a == n) or (b == n):
                break

            #проверить, что банка опустошена B
            if b==0:
                break
            else:
                #проверить, что ведро наполнено A      
                if a == a_full:
                    #опустошить ведро
                    print ("A>")             
                    a = 0


# C#
using System;

public class MainClass
{
    public static void Main()
    {
       int limit =(int)Math.Pow(10,5);
       Input (out int a);
       Input (out int b);
       Input (out int n);
       bool real = false;
       char min = 'A';
       char max = 'B';
       if (a==n)
       {
       Console.WriteLine($">{min}");
       return;
       }
       else if(b==n)
       {
        Console.WriteLine($">{max}");
        return;
       }
       else if (b<a)
       {
           if(b==n)
           {
               Console.WriteLine($">{max}");
               return;
           }
           else if (a==n)
           {
            Console.WriteLine($">{min}");
            return;
           }
          a+=b;
          b=a-b;
          a-=b;
           min = 'B';
           max = 'A';     
       }
      int bv=0;
      int k=0;
      while (k<=limit)
      {
          k+=2;
          
          if(b-bv>=a)
          bv+=a;
          
          else
          {
          bv=a-(b-bv);
          k+=2;
          }
          
          if(n==bv)
          {
              real=true;
              break;
          }
      }
  if (real)
  {
    bv=0;
    while(true)
    {
      Console.WriteLine($">{min}");
      Console.WriteLine($"{min}>{max}");
      
      if(b-bv>=a)
      {
      bv+=a;
      if(bv==n)
      break;
      }
      
      else
      {
        bv=a-(b-bv);
        if(n==bv)
        break;
        Console.WriteLine($"{max}>");
        Console.WriteLine($"{min}>{max}");
      }
    }
  }
   
 else
    Console.WriteLine("Impossible");
    }
    static void Input (out int x)
    {
        x=int.Parse(Console.ReadLine());
    }
}


# java
import java.util.ArrayList;
import java.util.List;
import java.util.Scanner;

class Main {

    public static void main(String[] args) {

        final String IMPOSSIBLE = "Impossible";

        Scanner scanner = new Scanner(System.in);
        int volumeA = scanner.nextInt();
        int volumeB = scanner.nextInt();
        int required = scanner.nextInt();

        if (required > volumeA && required > volumeB) {
            System.out.println(IMPOSSIBLE);
            return;
        }

        List<String> s1 = solve("A", "B", volumeA, volumeB, required);
        List<String> s2 = solve("B", "A", volumeB, volumeA, required);

        if (s1.isEmpty()) {
            System.out.println(IMPOSSIBLE);
        } else {
            System.out.println(String.join("\n", s1.size() <= s2.size() ? s1 : s2));
        }
    }

    private static List<String> solve(final String worker, final String receiver,
                                      final int workerMaxVol, final int receiverMaxVol, final int required) {
        int receiverVol = 0;
        int workerVol = workerMaxVol;
        List<String> solution = new ArrayList<>();
        solution.add(">" + worker);

        while (workerVol != required && receiverVol != required && (workerVol != 0 || receiverVol != 0)) {
            if (receiverVol == receiverMaxVol) {
                receiverVol = 0;
                solution.add(receiver + ">");
            } else if (workerVol == 0) {
                workerVol = workerMaxVol;
                solution.add(">" + worker);
            } else {
                int volumeToPour = Math.min(receiverMaxVol - receiverVol, workerVol);
                receiverVol += volumeToPour;
                workerVol -= volumeToPour;
                solution.add(worker + ">" + receiver);
            }
        }

        return workerVol == required || receiverVol == required ? solution : List.of();
    }
}


# C++
/*
Что- то не у кого не увидел условия: если НОД(А, В) не делит N  нацело, то решения нет. 
Может я не прав, или просто в тестах не предусмотрено. Может и проглядел, смотрел поверхностно.
*/
#include <iostream>
#include <cmath>
using namespace std;
int gcd(int a, int b) {
    if (a == 0) { return b; }
    int d = gcd(b % a, a);
    return d;
}
int A, B, N;
int f1(int x1, int y1) {    
    if (x1 == N || y1 == N) { return 0; }
    else {
        if ((B - y1) > A) {
            x1 = A; cout << ">A" << endl;
            x1 = 0;  y1 += A; cout << "A>B" << endl;
            return f1(x1, y1);
        }
        else {
            x1 = A; cout << ">A" << endl;
            x1 -= (B - y1); y1 += (A - x1); cout << "A>B" << endl;
            if (x1 == N || y1 == N) { return 0; }
            else {
                y1 = 0; cout << "B>" << endl;
                y1 = x1; x1 = 0; cout << "A>B" << endl;
                return f1(x1, y1);
            }
        }        
    }
}
int f2(int x1, int y1) {
    if (x1 == N || y1 == N) { return 0; }
    else {
        if ((A - x1) > B) {
            y1 = B; cout << ">B" << endl;
            y1 = 0;  x1 += B; cout << "B>A" << endl;
            return f2(x1, y1);
        }
        else {
            y1 = B; cout << ">B" << endl;
            y1 -= (A - x1); x1 += (B - y1); cout << "B>A" << endl;
            if (x1 == N || y1 == N) { return 0; }
            else {
                x1 = 0; cout << "A>" << endl;
                x1 = y1; y1 = 0; cout << "B>A" << endl;
                return f2(x1, y1);
            }
        }
    }
}
int main() {
    int x = 0, y = 0;
    cin >> A >> B >> N;
    if (N % gcd(A, B) != 0 || (N > max(A, B))) {
        cout << "Impossible";
        return 0;
    }
    if (A == N) { cout << ">A" << endl; return 0; }
    if (B == N) { cout << ">B" << endl; return 0; }
    if (A < B) { f1(x, y); } 
    else if (A > B) { f2(x, y); }
    else { cout << "Impossible"; }
    return 0;
}



